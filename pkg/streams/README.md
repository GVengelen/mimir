# Segment file format

The file format is:

```
┌──────────────────────────────────────────────────┐
│ Magic <4b>                                       │
├──────────────────────────────────────────────────┤
│ Version <2b>                                     │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ TOC                                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partitions                                   │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

Numbers are encoded using big endian.

### Partitions

The partitions section contains all partitions:

```
┌──────────────────────────────────────────────────┐
│ Number of partitions <4b>                        │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Partition #1                                 │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition #2                                 │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition #...                               │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Partition

A single partition section is split by tenant:

```
┌──────────────────────────────────────────────────┐
│ Number of tenants <4b>                           │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Partition tenant #1                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition tenant #2                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition tenant #...                        │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Partition tenant

A single partition-tenant section contains N messages:

```
┌──────────────────────────────────────────────────┐
│ Number of messages <4b>                          │
├──────────────────────────────────────────────────┤
│ Tenant ID length <4b>                            │
├──────────────────────────────────────────────────┤
│ Tenant ID <bytes>                                │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Message #1                                   │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Message #2                                   │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Message #...                                 │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Message

A message section contains a single message:

```
┌──────────────────────────────────────────────────┐
│ Message length <4b>                              │
├──────────────────────────────────────────────────┤
│ Message content <bytes>                          │
└──────────────────────────────────────────────────┘
```

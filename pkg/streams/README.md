# Segment file format

The file format is:

```
┌──────────────────────────────────────────────────┐
│ Magic <uint32>                                   │
├──────────────────────────────────────────────────┤
│ Version <uint16>                                 │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ TOC                                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partitions                                   │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

Numbers are encoded using big endian.

### TOC

The TOC section contains:

```
┌──────────────────────────────────────────────────┐
│                                    │
├──────────────────────────────────────────────────┤
│                                 │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │                                           │ │
│ ├──────────────────────────────────────────────┤ │
│ │                                    │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Partitions

The partitions section contains all partitions:

```
┌──────────────────────────────────────────────────┐
│ Number of partitions <uint32>                    │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Partition #1                                 │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition #2                                 │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition #...                               │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Partition

A single partition section is split by tenant:

// TODO add length

```
┌──────────────────────────────────────────────────┐
│ Number of tenants <uint32>                       │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Partition tenant #1                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition tenant #2                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Partition tenant #...                        │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Partition tenant

A single partition-tenant section contains N messages:

```
┌──────────────────────────────────────────────────┐
│ Number of messages <uint32>                      │
├──────────────────────────────────────────────────┤
│ Tenant ID length <uint32>                        │
├──────────────────────────────────────────────────┤
│ Tenant ID <bytes>                                │
├──────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐ │
│ │ Message #1                                   │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Message #2                                   │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Message #...                                 │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Message

A message section contains a single message:

```
┌──────────────────────────────────────────────────┐
│ Message length <uint32>                          │
├──────────────────────────────────────────────────┤
│ Message content <bytes>                          │
└──────────────────────────────────────────────────┘
```

TODO Add CRC
